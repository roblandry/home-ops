---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: n8n
  namespace: default
spec:
  interval: 30m
  url: https://8gears.container-registry.com/chartrepo/library
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/helm.toolkit.fluxcd.io/helmrelease_v2beta2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: n8n
  namespace: default
spec:
  interval: 30m
  chart:
    spec:
      chart: n8n
      version: 0.22.0
      sourceRef:
        kind: HelmRepository
        name: n8n
        namespace: default
  # install:
  #   createNamespace: false
  values:
    image:
      repository: docker.n8n.io/n8nio/n8n
      tag: latest

    # env:
    #   - name: N8N_BASIC_AUTH_ACTIVE
    #     value: "true"
    #   - name: N8N_BASIC_AUTH_USER
    #     valueFrom:
    #       secretKeyRef:
    #         name: n8n-secret
    #         key: N8N_BASIC_AUTH_USER
    #   - name: N8N_BASIC_AUTH_PASSWORD
    #     valueFrom:
    #       secretKeyRef:
    #         name: n8n-secret
    #         key: N8N_BASIC_AUTH_PASSWORD
    #   - name: WEBHOOK_URL
    #     value: https://n8n.landrys.io/

    envFrom:
      - secretRef:
          name: n8n-secret

    persistence:
      enabled: true
      accessMode: ReadWriteMany
      size: 5Gi
      storageClass: csi-driver-nfs

    service:
      type: ClusterIP
      port: 5678

    replicaCount: 1
    podAnnotations:
      secret.reloader.stakater.com/reload: n8n-secret
