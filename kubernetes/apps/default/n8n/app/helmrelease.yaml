---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: n8n
  namespace: default
spec:
  interval: 30m
  url: https://8gears.container-registry.com/chartrepo/library
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/helm.toolkit.fluxcd.io/helmrelease_v2beta2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: n8n
  namespace: default
spec:
  interval: 30m
  chart:
    spec:
      chart: n8n
      version: 0.22.0
      sourceRef:
        kind: HelmRepository
        name: n8n
        namespace: default
  values:
    image:
      repository: docker.n8n.io/n8nio/n8n
      tag: latest

    persistence:
      enabled: true
      accessMode: ReadWriteMany
      size: 5Gi
      storageClass: csi-driver-nfs

    envFrom:
      - secretRef:
          name: n8n-secret

    # ingress:
    #   enabled: true
    #   className: traefik
    #   annotations:
    #     external-dns.alpha.kubernetes.io/hostname: n8n.landrys.io
    #     cert-manager.io/cluster-issuer: letsencrypt-production
    #     traefik.ingress.kubernetes.io/router.entrypoints: websecure
    #   hosts:
    #     - host: n8n.landrys.io
    #       paths:
    #         - path: /
    #           pathType: Prefix
    #   tls:
    #     - hosts:
    #         - n8n.landrys.io
    #       secretName: landrys-io-production-tls
